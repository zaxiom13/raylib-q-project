<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>raylib-q: Graphics Programming with q/kdb+</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #1c2333;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --accent: #58a6ff;
      --accent2: #3fb950;
      --accent3: #d2a8ff;
      --accent4: #f0883e;
      --accent5: #ff7b72;
      --accent6: #79c0ff;
      --code-bg: #0d1117;
      --highlight: #1f6feb22;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      font-size: 16px;
    }

    .hero {
      background: linear-gradient(135deg, #0d1117 0%, #161b22 40%, #1a1040 70%, #0d1117 100%);
      border-bottom: 1px solid var(--border);
      padding: 80px 24px 60px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 60% 40%, #58a6ff08 0%, transparent 60%),
                  radial-gradient(ellipse at 30% 70%, #d2a8ff06 0%, transparent 50%);
      pointer-events: none;
    }
    .hero h1 {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #58a6ff, #d2a8ff, #f0883e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 16px;
      position: relative;
    }
    .hero .subtitle {
      font-size: 1.25rem;
      color: var(--text-muted);
      max-width: 640px;
      margin: 0 auto 32px;
      position: relative;
    }
    .hero-badges {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      position: relative;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid var(--border);
      background: var(--surface);
    }
    .badge.q { color: #58a6ff; }
    .badge.c { color: #3fb950; }
    .badge.raylib { color: #d2a8ff; }
    .badge.ffi { color: #f0883e; }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 24px;
    }

    .toc {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
      margin: 48px auto;
      max-width: 700px;
    }
    .toc h2 {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent);
    }
    .toc ol {
      list-style: none;
      counter-reset: toc;
    }
    .toc ol li {
      counter-increment: toc;
      margin-bottom: 10px;
    }
    .toc ol li a {
      color: var(--text);
      text-decoration: none;
      display: flex;
      align-items: baseline;
      gap: 12px;
      padding: 6px 12px;
      border-radius: 8px;
      transition: background 0.15s;
    }
    .toc ol li a:hover {
      background: var(--highlight);
      color: var(--accent);
    }
    .toc ol li a::before {
      content: counter(toc, decimal-leading-zero);
      font-weight: 700;
      font-size: 0.85rem;
      color: var(--accent3);
      min-width: 28px;
    }

    .lesson {
      margin: 64px 0;
      padding-top: 32px;
    }
    .lesson-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
    }
    .lesson-number {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    .lesson-number.blue { background: #58a6ff22; color: #58a6ff; }
    .lesson-number.green { background: #3fb95022; color: #3fb950; }
    .lesson-number.purple { background: #d2a8ff22; color: #d2a8ff; }
    .lesson-number.orange { background: #f0883e22; color: #f0883e; }
    .lesson-number.red { background: #ff7b7222; color: #ff7b72; }
    .lesson-number.teal { background: #39d3d322; color: #39d3d3; }

    .lesson h2 {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .lesson h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 32px 0 16px;
      color: var(--accent6);
    }

    p { margin-bottom: 16px; }

    pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px 24px;
      overflow-x: auto;
      margin: 16px 0 24px;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    pre code {
      font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
      color: var(--text);
    }
    code {
      font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
      background: var(--surface2);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.9em;
      color: var(--accent3);
    }
    pre code { background: none; padding: 0; }

    .kw { color: #ff7b72; }
    .fn { color: #d2a8ff; }
    .str { color: #a5d6ff; }
    .cm { color: #8b949e; }
    .num { color: #79c0ff; }
    .type { color: #f0883e; }
    .sym { color: #3fb950; }
    .op { color: #ff7b72; }

    .callout {
      border-radius: 8px;
      padding: 20px 24px;
      margin: 24px 0;
      border-left: 4px solid;
    }
    .callout.info {
      background: #58a6ff0a;
      border-color: #58a6ff;
    }
    .callout.warn {
      background: #f0883e0a;
      border-color: #f0883e;
    }
    .callout.tip {
      background: #3fb9500a;
      border-color: #3fb950;
    }
    .callout.key {
      background: #d2a8ff0a;
      border-color: #d2a8ff;
    }
    .callout-title {
      font-weight: 700;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }
    .callout.info .callout-title { color: #58a6ff; }
    .callout.warn .callout-title { color: #f0883e; }
    .callout.tip .callout-title { color: #3fb950; }
    .callout.key .callout-title { color: #d2a8ff; }

    .example-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
    }
    .example-box h4 {
      color: var(--accent);
      margin-bottom: 16px;
      font-size: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0 24px;
      font-size: 0.9rem;
    }
    th {
      text-align: left;
      padding: 10px 14px;
      background: var(--surface);
      color: var(--accent);
      font-weight: 700;
      border-bottom: 2px solid var(--border);
    }
    td {
      padding: 10px 14px;
      border-bottom: 1px solid var(--border);
    }
    tr:hover td { background: var(--highlight); }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 48px 0;
    }

    footer {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
    }

    html { scroll-behavior: smooth; }

    details {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin: 16px 0;
    }
    details summary {
      padding: 14px 20px;
      cursor: pointer;
      font-weight: 600;
      color: var(--accent);
      user-select: none;
    }
    details summary:hover { background: var(--highlight); border-radius: 8px; }
    details[open] summary { border-bottom: 1px solid var(--border); }
    details .inner { padding: 20px; }
  </style>
</head>
<body>

<header class="hero">
  <h1>raylib-q: Graphics for q/kdb+</h1>
  <p class="subtitle">
    Create interactive visualizations, real-time dashboards, and animated graphics<br>
    using q's table-first approach with the raylib graphics library
  </p>
  <div class="hero-badges">
    <span class="badge q">q/kdb+</span>
    <span class="badge c">C Runtime</span>
    <span class="badge raylib">raylib</span>
    <span class="badge ffi">FFI Bridge</span>
  </div>
</header>

<div class="container">

<!-- QUICK START -->
<section class="lesson" style="margin-top: 32px;">
  <div class="lesson-header">
    <div class="lesson-number blue">00</div>
    <h2>Quick Start</h2>
  </div>

  <p>Get your first graphics window open in under a minute:</p>

  <div class="example-box">
    <h4>1. Build and Install</h4>
    <pre><code><span class="cm"># One-time setup - installs to ~/.kx for all q sessions</span>
make clean && make
make test
make install</span></code></pre>
  </div>

  <div class="example-box">
    <h4>2. Hello Graphics</h4>
    <pre><code><span class="cm">/ Open a window and draw circles</span>
.raylib.open[];

circles:([] x:100 250 400f; y:200 200 200f; r:30 50 40f; color:(.raylib.Color.RED;.raylib.Color.GREEN;.raylib.Color.BLUE));
.raylib.circle circles;</span></code></pre>
  </div>

  <div class="example-box">
    <h4>3. Interactive Mouse Following</h4>
    <pre><code><span class="cm">/ A circle that follows your mouse</span>
mx:400f; my:225f;

<span class="cm">/ Use lambdas for dynamic values</span>
cursor:([] x:enlist {mx}; y:enlist {my}; r:enlist 25f; color:enlist .raylib.Color.YELLOW);
.raylib.circle cursor;

<span class="cm">/ Start interactive mode - move your mouse!</span>
.raylib.interactive.start[];
<span class="cm">/ Press Esc to stop</span></code></pre>
  </div>

  <div class="example-box">
    <h4>4. Animated Bouncing Ball</h4>
    <pre><code><span class="cm">/ Create a looping animation from keyframes</span>
keyframes:([] x:100 400 700 400f; y:100 400 100 400f; r:30 40 30 40f; rate:0.3 0.3 0.3 0.3f; interpolate:1111b);

.raylib.animate.circle keyframes;</span></code></pre>
  </div>

  <div class="callout key">
    <div class="callout-title">What makes raylib-q unique?</div>
    <p style="margin:0;">
      Every drawing function accepts a <strong>table</strong>. Rows are shapes, columns are properties.
      This matches how q thinks about data - your graphics are just another table operation.
    </p>
  </div>
</section>

<hr>

<!-- TABLE OF CONTENTS -->
<nav class="toc">
  <h2>Contents</h2>
  <ol>
    <li><a href="#lesson-1">Installation & Setup</a></li>
    <li><a href="#lesson-2">Core Concepts</a></li>
    <li><a href="#lesson-3">Drawing Primitives</a></li>
    <li><a href="#lesson-4">Scene Management</a></li>
    <li><a href="#lesson-5">Animation & Tweening</a></li>
    <li><a href="#lesson-6">Interactive Mode & Events</a></li>
    <li><a href="#lesson-7">UI Toolkit</a></li>
    <li><a href="#lesson-8">Practical Examples</a></li>
    <li><a href="#lesson-9">API Reference</a></li>
  </ol>
</nav>

<hr>

<!-- LESSON 1 -->
<section class="lesson" id="lesson-1">
  <div class="lesson-header">
    <div class="lesson-number blue">01</div>
    <h2>Installation & Setup</h2>
  </div>

  <h3>Requirements</h3>
  <table>
    <tr><th>Tool</th><th>Why</th><th>Install</th></tr>
    <tr><td>q/kdb+</td><td>The host language</td><td><code>kx.com</code> personal edition</td></tr>
    <tr><td>raylib</td><td>C graphics library</td><td><code>brew install raylib</code></td></tr>
    <tr><td>C compiler</td><td>Build the runtime</td><td><code>xcode-select --install</code> (macOS)</td></tr>
    <tr><td>pkg-config</td><td>Find raylib flags</td><td><code>brew install pkg-config</code></td></tr>
  </table>

  <h3>Build</h3>
  <pre><code><span class="cm"># Build the shared library and init script</span>
make

<span class="cm"># Run the test suite (headless - no window required)</span>
make test

<span class="cm"># Install to ~/.kx so every q session has .raylib.*</span>
make install</span></code></pre>

  <div class="callout tip">
    <div class="callout-title">Always run make install after changes</div>
    <p style="margin:0;">The install step copies files to <code>~/.kx/</code> and sets up QINIT. 
    Without this, q sessions won't see your changes.</p>
  </div>
</section>

<hr>

<!-- LESSON 2 -->
<section class="lesson" id="lesson-2">
  <div class="lesson-header">
    <div class="lesson-number green">02</div>
    <h2>Core Concepts</h2>
  </div>

  <h3>Table-First Graphics</h3>
  <p>
    Traditional graphics APIs work one shape at a time. raylib-q works with <strong>tables</strong>:
  </p>

  <pre><code><span class="cm">/ Instead of: drawCircle(100, 200, 30)</span>
<span class="cm">/ You write:</span>
.raylib.circle ([] x:100f; y:200f; r:30f)

<span class="cm">/ Draw 100 circles at once:</span>
n:100;
.raylib.circle ([] x:til n; y:n?400; r:n#15f; color:n?(.raylib.Color.RED;.raylib.Color.GREEN;.raylib.Color.BLUE))</span></code></pre>

  <h3>Architecture</h3>
  <p>Three layers working together:</p>
  <ol style="margin-bottom: 16px;">
    <li><strong>q Layer</strong>: Tables → command tuples</li>
    <li><strong>C Runtime</strong>: Parse → store → render</li>
    <li><strong>raylib/GPU</strong>: Actual pixels on screen</li>
  </ol>

  <h3>Callable References</h3>
  <p>The most powerful pattern: use lambdas for dynamic values:</p>
  <pre><code><span class="cm">/ Define WHAT to draw once</span>
cursor:([] x:enlist {mx}; y:enlist {my}; r:enlist 20f)

<span class="cm">/ Update WHERE by changing globals</span>
mx:100f; my:200f
.raylib.refresh[]  <span class="cm">/ redraws at new position</span></span></code></pre>
</section>

<hr>

<!-- LESSON 3 -->
<section class="lesson" id="lesson-3">
  <div class="lesson-header">
    <div class="lesson-number purple">03</div>
    <h2>Drawing Primitives</h2>
  </div>

  <h3>Supported Shapes</h3>
  <table>
    <tr><th>Function</th><th>Required Columns</th><th>Example</th></tr>
    <tr><td><code>.raylib.circle</code></td><td>x, y, r</td><td><code>([] x:100f; y:200f; r:30f)</code></td></tr>
    <tr><td><code>.raylib.rect</code></td><td>x, y, w, h</td><td><code>([] x:50f; y:50f; w:100f; h:80f)</code></td></tr>
    <tr><td><code>.raylib.line</code></td><td>x1, y1, x2, y2</td><td><code>([] x1:0f; y1:0f; x2:800f; y2:450f)</code></td></tr>
    <tr><td><code>.raylib.triangle</code></td><td>x, y, r</td><td><code>([] x:400f; y:225f; r:50f)</code></td></tr>
    <tr><td><code>.raylib.square</code></td><td>x, y, r</td><td><code>([] x:100f; y:100f; r:40f)</code></td></tr>
    <tr><td><code>.raylib.point</code></td><td>x, y</td><td><code>([] x:10 20 30f; y:15 25 35f)</code></td></tr>
    <tr><td><code>.raylib.text</code></td><td>x, y, text, size</td><td><code>([] x:100f; y:100f; text:"Hello"; size:24i)</code></td></tr>
  </table>

  <h3>Common Options</h3>
  <p>All primitives accept these optional columns:</p>
  <ul style="margin-bottom: 16px;">
    <li><code>color</code>: RGB or RGBA vector (e.g., <code>255 0 0 255i</code>)</li>
    <li><code>alpha</code>: Override color's alpha (0-255)</li>
    <li><code>layer</code>: Draw order (higher = on top)</li>
    <li><code>rotation</code>: Rotation in degrees</li>
  </ul>

  <div class="example-box">
    <h4>Example: Random Scatter Plot</h4>
    <pre><code><span class="cm">/ Generate random data points</span>
n:500; xs:n?800f; ys:n?450f;
colors:n?(.raylib.Color.RED;.raylib.Color.GREEN;.raylib.Color.BLUE;.raylib.Color.YELLOW;.raylib.Color.PURPLE);

<span class="cm">/ Draw all at once</span>
points:([] x:xs; y:ys; color:colors);
.raylib.point points;</span></code></pre>
  </div>

  <div class="example-box">
    <h4>Example: Gradient Rectangles</h4>
    <pre><code><span class="cm">/ Create a color gradient</span>
steps:20; xs:(til steps)*(800f%steps);
colors:{((255i-"i"$x*12);0i;("i"$x*12);255i)} each til steps;

rects:([] x:xs; y:200f; w:38f; h:100f; color:colors);
.raylib.rect rects;</span></code></pre>
  </div>

  <h3>Generic Draw Dispatcher</h3>
  <pre><code>.raylib.draw[`circle; ([] x:enlist 100f; y:enlist 200f; r:enlist 30f)]
.raylib.draw[`rect; ([] x:enliist 50f; y:enlist 50f; w:enlist 100f; h:enlist 80f)]
.raylib.draw[`line; ([] x1:enlist 0f; y1:enlist 0f; x2:enlist 800f; y2:enlist 450f)]</span></code></pre>
</section>

<hr>

<!-- LESSON 4 -->
<section class="lesson" id="lesson-4">
  <div class="lesson-header">
    <div class="lesson-number orange">04</div>
    <h2>Scene Management</h2>
  </div>

  <p>
    The scene registry lets you organize drawings by ID, control visibility, and manage layers.
    Think of it as a table of draw sources that you can update dynamically.
  </p>

  <h3>Basic Scene Operations</h3>
  <pre><code><span class="cm">/ Open window</span>
.raylib.open[];

<span class="cm">/ Add named scene entries</span>
bg:([] x:enlist 0f; y:enlist 0f; w:enlist 800f; h:enlist 450f; color:enlist 240 240 240 255i);
.raylib.scene.rect[`background; bg];

player:([] x:enlist 100f; y:enlist 200f; r:enlist 30f; color:enlist .raylib.Color.BLUE);
.raylib.scene.circle[`player; player];

hud:([] x:enlist 20f; y:enlist 20f; text:enlist "Score: 0"; size:enlist 24i);
.raylib.scene.text[`hud; hud];

<span class="cm">/ Hide/show scene elements</span>
.raylib.scene.visible[`hud; 0b];  <span class="cm">/ hide</span>
.raylib.scene.visible[`hud; 1b];  <span class="cm">/ show</span>

<span class="cm">/ Remove from scene</span>
.raylib.scene.delete `background;</span></code></pre>

  <h3>Updating Scene Data</h3>
  <pre><code><span class="cm">/ Method 1: Replace the entire source table</span>
player:([] x:enlist 150f; y:enlist 250f; r:enlist 30f; color:enlist .raylib.Color.BLUE);
.raylib.scene.circle[`player; player];

<span class="cm">/ Method 2: Use scene.set to patch specific columns</span>
.raylib.scene.set[`player; `x; enlist 200f];
.raylib.scene.set[`player; `x`y; (200f; 300f)];</span></code></pre>

  <h3>Layer Ordering</h3>
  <p>Scene entries are drawn in layer order (0 first, higher numbers on top):</p>
  <pre><code><span class="cm">/ Layer 0: background</span>
bg:([] x:enlist 0f; y:enlist 0f; w:enlist 800f; h:enlist 450f);
.raylib.scene.upsertEx[`bg; `rect; bg; ()!(); 0i; 1b];

<span class="cm">/ Layer 1: game objects</span>
obj:([] x:100f; y:100f; r:30f);
.raylib.scene.upsertEx[`obj; `circle; obj; ()!(); 1i; 1b];

<span class="cm">/ Layer 2: UI on top</span>
ui:([] x:20f; y:20f; text:"HUD"; size:24i);
.raylib.scene.upsertEx[`ui; `text; ui; ()!(); 2i; 1b];</span></code></pre>

  <div class="example-box">
    <h4>Example: Orbiting Planets</h4>
    <pre><code><span class="cm">/ Set up orbital system</span>
theta:0f; mx:400f; my:225f; radii:0 60 100f; phases:0 0 2.09f;

<span class="cm">/ Create planet table with fixed initial positions</span>
planets:([] x:mx+radii*cos theta+phases; y:my+radii*sin theta+phases; r:15 10 12f; color:(.raylib.Color.YELLOW;.raylib.Color.BLUE;.raylib.Color.RED));

.raylib.scene.circle[`orbits; planets];

<span class="cm">/ Update theta and scene positions each frame</span>
.raylib.frame.on {[state] theta+:0.02f; .raylib.scene.set[`orbits; `x`y; (mx+radii*cos theta+phases; my+radii*sin theta+phases)]; .raylib.refresh[]; :0};
.raylib.frame.run 0;</span></code></pre>
  </div>
</section>

<hr>

<!-- LESSON 5 -->
<section class="lesson" id="lesson-5">
  <div class="lesson-header">
    <div class="lesson-number red">05</div>
    <h2>Animation & Tweening</h2>
  </div>

  <h3>C-Side Animation (Looping)</h3>
  <p>Each row in your table is one frame. The C runtime loops through them:</p>
  <pre><code><span class="cm">/ Bouncing ball animation</span>
frames:([] x:100 250 400 550 700 550 400 250f; y:100 400 100 400 100 400 100 400f; r:30 35 40 35 30 35 40 35f; rate:0.15 0.15 0.15 0.15 0.15 0.15 0.15 0.15f; interpolate:11111111b);

.raylib.animate.circle frames;</span></code></pre>

  <h3>Tween Builder</h3>
  <p>Generate interpolated frames between two states:</p>
  <pre><code><span class="cm">/ From state A to state B</span>
from:([] x:enlist 100f; y:enlist 100f; r:enlist 20f);
to:([] x:enlist 700f; y:enlist 350f; r:enlist 60f);

<span class="cm">/ Generate 60 frames over 2 seconds with easing</span>
tween:.raylib.tween.table[from;to;2f;60;`inOutQuad];
.raylib.animate.circle tween;</span></code></pre>

  <h3>Keyframe Animation</h3>
  <pre><code><span class="cm">/ Define keyframes at specific times (seconds)</span>
kf:([] at:0 0.5 1.0 1.5f; x:100 400 400 100f; y:100 100 400 400f; r:20 40 20 40f);

<span class="cm">/ Expand to 30fps with easing between keyframes</span>
frames:.raylib.keyframesTable[kf;30;`linear];
.raylib.animate.circle frames;</span></code></pre>

  <h3>Animation Control</h3>
  <pre><code>.raylib.animate.stop[]   <span class="cm">/ pause all animations</span>
.raylib.animate.start[]  <span class="cm">/ resume animations</span></span></code></pre>

  <h3>Easing Functions</h3>
  <p>Available easings: <code>linear</code>, <code>inQuad</code>, <code>outQuad</code>, <code>inOutQuad</code></p>
  <pre><code>.raylib.easings[]  <span class="cm">/ list all available</span></span></code></pre>
</section>

<hr>

<!-- LESSON 6 -->
<section class="lesson" id="lesson-6">
  <div class="lesson-header">
    <div class="lesson-number teal">06</div>
    <h2>Interactive Mode & Events</h2>
  </div>

  <h3>Global Mouse Variables</h3>
  <p>Interactive mode automatically updates these globals:</p>
  <table>
    <tr><th>Variable</th><th>Type</th><th>Description</th></tr>
    <tr><td><code>mx</code></td><td>float</td><td>Mouse X position</td></tr>
    <tr><td><code>my</code></td><td>float</td><td>Mouse Y position</td></tr>
    <tr><td><code>mdx</code></td><td>float</td><td>Mouse X delta (movement)</td></tr>
    <tr><td><code>mdy</code></td><td>float</td><td>Mouse Y delta</td></tr>
    <tr><td><code>mbutton</code></td><td>int</td><td>Button pressed (0=left, 1=right, 2=middle)</td></tr>
    <tr><td><code>mpressed</code></td><td>bool</td><td>Is mouse button pressed?</td></tr>
    <tr><td><code>mwheel</code></td><td>float</td><td>Scroll wheel delta</td></tr>
    <tr><td><code>mkey</code></td><td>int</td><td>Last key pressed</td></tr>
    <tr><td><code>windowW</code></td><td>int</td><td>Window width</td></tr>
    <tr><td><code>windowH</code></td><td>int</td><td>Window height</td></tr>
  </table>

  <h3>Starting Interactive Mode</h3>
  <pre><code><span class="cm">/ Simple: start timer-driven loop, Esc to stop</span>
.raylib.interactive.start[];

<span class="cm">/ Check if running</span>
.raylib.interactive.active</span></code></pre>

  <h3>Event Callbacks</h3>
  <pre><code><span class="cm">/ Register event handler</span>
id:.raylib.events.on {[ev]
  if[(ev[`type] 0)=`mouse_down;
    show "Clicked at: ",string[ev[`a] 0]," , ",string[ev[`b] 0]];
  :0
 };

<span class="cm">/ Pump events manually (in your own loop)</span>
.raylib.events.pump[];

<span class="cm">/ Remove callback</span>
.raylib.events.off id;
.raylib.events.callbacks.clear[];</span></code></pre>

  <h3>Frame Callbacks</h3>
  <p>Register functions that run every frame tick:</p>
  <pre><code><span class="cm">/ Set frame timing (60 FPS)</span>
.raylib.frame.setDt 0.0166667f;

<span class="cm">/ Register callback - receives state dict with frame, time, dt</span>
cb:.raylib.frame.on {[state]
  <span class="cm">/ Update your scene here</span>
  :0
 };

<span class="cm">/ Run 120 ticks immediately (no sleep)</span>
.raylib.frame.step 120;

<span class="cm">/ Run with real-time delays</span>
.raylib.frame.run 300;

<span class="cm">/ Cleanup</span>
.raylib.frame.off cb;
.raylib.frame.clear[];</span></code></pre>

  <div class="example-box">
    <h4>Example: Paint Program</h4>
    <pre><code><span class="cm">/ Simple paint: click and drag to draw</span>
.raylib.open[];
.raylib.scene.reset[];

<span class="cm">/ Store brush strokes</span>
strokes:([](x:`float$(); y:`float$(); r:`float$()));

<span class="cm">/ Add new stroke on click</span>
cb:.raylib.frame.on {[state]
  if[mpressed & mbutton in 0 -1;
    strokes,: ([] x:enlist mx; y:enlist my; r:enlist 5f)];
  :0
 };

<span class="cm">/ Draw all strokes as scene</span>
.raylib.scene.point[`paint; `strokes];
.raylib.interactive.start[];</span></code></pre>
  </div>
</section>

<hr>

<!-- LESSON 7 -->
<section class="lesson" id="lesson-7">
  <div class="lesson-header">
    <div class="lesson-number purple">07</div>
    <h2>UI Toolkit</h2>
  </div>

  <h3>UI Frame Pattern</h3>
  <p>UI uses immediate mode - redraw every frame:</p>
  <pre><code><span class="cm">/ Draw one UI frame</span>
.raylib.ui.frame {[] .raylib.ui.panel ([] x:20f; y:20f; w:300f; h:200f; title:"Panel"); .raylib.ui.text[40f; 60f; "Hello UI"; 24i]; };</span></code></pre>

  <h3>Interactive Buttons</h3>
  <pre><code>counter:0i;

.raylib.ui.frame {[] clicked:.raylib.ui.buttonClick[`inc; 50 50 120 40f; "Count: ",string counter; {[] counter+:1}; `press]; };</span></code></pre>

  <h3>Sliders</h3>
  <pre><code>volume:50f;

slider:([] x:50f; y:120f; w:200f; lo:0f; hi:100f; val:volume; label:enlist "Volume"; showValue:1b);

<span class="cm">/ sliderValue returns updated table with new values</span>
.raylib.ui.frame {[]
  slider::.raylib.ui.sliderValue slider;
  volume::slider[`val] 0;
  .raylib.ui.slider slider;
 };</span></code></pre>

  <h3>Charts</h3>
  <pre><code><span class="cm">/ Line chart</span>
data:10?100f;
.raylib.ui.chartLine ([] x:50f; y:200f; w:300f; h:150f; values:enlist data; title:"Data"; min:0f; max:100f);

<span class="cm">/ Bar chart</span>
.raylib.ui.chartBar ([] x:400f; y:200f; w:300f; h:150f; values:enlist data; title:"Distribution");</span></code></pre>

  <h3>Inspector Panel</h3>
  <p>Display variable values in a panel:</p>
  <pre><code>score:100i;
lives:3i;
level:1i;

.raylib.ui.frame {[] inspector:([] x:enlist 550f; y:enlist 50f; field:(`Score`Lives`Level); val:(score;lives;level)); .raylib.ui.inspector inspector; };</span></code></pre>

  <div class="callout tip">
    <div class="callout-title">Button Click Modes</div>
    <p style="margin:0;">
      <code>`press</code> - Fire immediately when mouse goes down (good for rapid actions)<br>
      <code>`release</code> - Fire when mouse comes up (good for confirmations)
    </p>
  </div>
</section>

<hr>

<!-- LESSON 8 -->
<section class="lesson" id="lesson-8">
  <div class="lesson-header">
    <div class="lesson-number blue">08</div>
    <h2>Practical Examples</h2>
  </div>

  <div class="example-box">
    <h4>Example 1: Real-time Data Dashboard</h4>
    <pre><code><span class="cm">/ Display live updating metrics</span>
.raylib.open[];
.raylib.scene.reset[];

  <span class="cm">/ Initialize data buffers</span>
prices:100?100f; volume:0i;

<span class="cm">/ Use frame callback for animation loop</span>
.raylib.frame.on {[state] prices::1_prices,(last[prices]+-0.5+?1f); .raylib.ui.frame {[] .raylib.ui.panel ([] x:20f; y:20f; w:760f; h:410f; title:"Market Data"); .raylib.ui.chartLine ([] x:50f; y:80f; w:400f; h:200f; values:enlist prices; title:"Price History"); avg:avg prices; mx:max prices; mn:min prices; stats:([] x:enlist 480f; y:enlist 80f; field:(`Average`Max`Min`Volume); val:(avg;mx;mn;volume)); .raylib.ui.inspector stats; .raylib.ui.buttonClick[`refresh; 480 300 100 40f; "Refresh"; {[] volume+:100i}; `press]; }; :0};
.raylib.frame.run 0;</span></code></pre>
  </div>

  <div class="example-box">
    <h4>Example 2: Interactive Particle System</h4>
    <pre><code><span class="cm">/ Particles that follow mouse with trails</span>
.raylib.open[];
.raylib.scene.reset[];

n:50; px:n?800f; py:n?450f; vx:n#0f; vy:n#0f;

<span class="cm">/ Use frame callback for physics update and draw</span>
.raylib.frame.on {[state] dx::mx-px; dy::my-py; dist::sqrt (dx*dx)+dy*dy; dist::dist+0.001f; ax::dx%dist*10f; ay::dy%dist*10f; vx+::ax*0.016f; vy+::ay*0.016f; vx*::0.98f; vy*::0.98f; px+::vx; py+::vy; particles::([] x:px; y:py; r:n#5f; color:n?.raylib.Color.RED,.raylib.Color.ORANGE,.raylib.Color.YELLOW); .raylib.clear[]; .raylib.circle particles; :0};
.raylib.frame.run 0;</span></code></pre>
  </div>

  <div class="example-box">
    <h4>Example 3: Sorting Visualization</h4>
    <pre><code><span class="cm">/ Visualize bubble sort</span>
.raylib.open[];

n:30; vals:n?n; barWidth:780f%n;

bubbleSort:{[arr]
  n:count arr;
  i:0;
  while[i<n-1;
    j:0;
    while[j<n-i-1;
      if[arr[j]>arr[j+1];
        tmp:arr[j];
        arr[j]:arr[j+1];
        arr[j+1]:tmp;
        
        <span class="cm">/ Draw current state</span>
        .raylib.clear[];
        bars:([] x:(til n)*barWidth+5f; y:450f-(arr*15f); w:barWidth-2f; h:arr*15f; color:n#.raylib.Color.BLUE);
        <span class="cm">/ Highlight swapped elements</span>
        bars[j;`color]:.raylib.Color.RED;
        bars[j+1;`color]:.raylib.Color.RED;
        .raylib.rect bars;
        .raylib.frame.step 1;
       ];
      j+:1;
     ];
    i+:1;
   ];
  :arr
 };

bubbleSort vals;</span></code></pre>
  </div>
</section>

<hr>

<!-- LESSON 9 -->
<section class="lesson" id="lesson-9">
  <div class="lesson-header">
    <div class="lesson-number green">09</div>
    <h2>API Reference</h2>
  </div>

  <h3>Lifecycle</h3>
  <pre><code>.raylib.open[]              <span class="cm">/ Open or reuse window</span>
.raylib.close[]             <span class="cm">/ Close window</span>
.raylib.clear[]             <span class="cm">/ Clear all shapes</span>
.raylib.refresh[]           <span class="cm">/ Redraw scene registry</span>
.raylib.tick[]              <span class="cm">/ Poll events once</span></span></code></pre>

  <h3>Drawing Primitives</h3>
  <pre><code>.raylib.circle t             <span class="cm">/ t:([] x:f; y:f; r:f)</span>
.raylib.rect t               <span class="cm">/ t:([] x:f; y:f; w:f; h:f)</span>
.raylib.line t               <span class="cm">/ t:([] x1:f; y1:f; x2:f; y2:f)</span>
.raylib.triangle t           <span class="cm">/ t:([] x:f; y:f; r:f)</span>
.raylib.square t             <span class="cm">/ t:([] x:f; y:f; r:f)</span>
.raylib.point t              <span class="cm">/ t:([] x:f; y:f)</span>
.raylib.text t               <span class="cm">/ t:([] x:f; y:f; text:s; size:i)</span>
.raylib.draw[`kind;t]        <span class="cm">/ Generic dispatcher</span></span></code></pre>

  <h3>Scene</h3>
  <pre><code>.raylib.scene.upsert[id;kind;src]
.raylib.scene.upsertEx[id;kind;src;bindings;layer;visible]
.raylib.scene.set[id;cols;vals]
.raylib.scene.delete id
.raylib.scene.visible[id;0b|1b]
.raylib.scene.clearLayer layer
.raylib.scene.list[]
.raylib.scene.reset[]</span></code></pre>

  <h3>Animation</h3>
  <pre><code>.raylib.animate.circle t
.raylib.animate.rect t
.raylib.animate.line t
.raylib.anim[`kind;t]        <span class="cm">/ Generic</span>
.raylib.animate.stop[]
.raylib.animate.start[]
.raylib.tween.table[from;to;duration;steps;easing]
.raylib.keyframesTable[kf;fps;easing]
.raylib.easings[]</span></code></pre>

  <h3>Interactive</h3>
  <pre><code>.raylib.interactive.start[]
.raylib.interactive.stop[]
.raylib.interactive.tick[]
.raylib.interactive.live.list[]
.raylib.interactive.live.clear[]</span></code></pre>

  <h3>Events</h3>
  <pre><code>.raylib.events.poll[]
.raylib.events.on[fn]
.raylib.events.off[id]
.raylib.events.callbacks.clear[]
.raylib.events.clear[]
.raylib.events.pump[]</span></code></pre>

  <h3>Frame Loop</h3>
  <pre><code>.raylib.frame.setDt[seconds]
.raylib.frame.on[fn]
.raylib.frame.off[id]
.raylib.frame.clear[]
.raylib.frame.step[count]
.raylib.frame.run[count]
.raylib.frame.reset[]</span></code></pre>

  <h3>UI</h3>
  <pre><code>.raylib.ui.frame[fn]
.raylib.ui.begin[]
.raylib.ui.end[]
.raylib.ui.panel t
.raylib.ui.button t
.raylib.ui.buttonClick[id;rect;label;fn;mode]
.raylib.ui.buttonPress[id;rect;label;fn]
.raylib.ui.buttonRelease[id;rect;label;fn]
.raylib.ui.slider t
.raylib.ui.sliderValue t
.raylib.ui.chartLine t
.raylib.ui.chartBar t
.raylib.ui.chart[`line|bar;t]
.raylib.ui.inspector t
.raylib.ui.text[x;y;txt;size]
.raylib.ui.hit.rect t
.raylib.ui.buttonState t
.raylib.ui.state.reset[]</span></code></pre>

  <h3>Helpers</h3>
  <pre><code>.raylib.colors[]            <span class="cm">/ List color constants</span>
.raylib.help[`fnName]       <span class="cm">/ Built-in help</span>
.raylib.shape.info x        <span class="cm">/ Array shape info</span>
.raylib.shape.pretty x      <span class="cm">/ Pretty print arrays</span>
.raylib.shape.show x        <span class="cm">/ Print array visualization</span></span></code></pre>

  <h3>Color Constants</h3>
  <pre><code>.raylib.Color.RED
.raylib.Color.GREEN
.raylib.Color.BLUE
.raylib.Color.YELLOW
.raylib.Color.ORANGE
.raylib.Color.PURPLE
.raylib.Color.WHITE
.raylib.Color.BLACK
.raylib.Color.MAROON</span></code></pre>
</section>

<hr>

<section class="lesson">
  <div class="callout key">
    <div class="callout-title">Key Takeaway</div>
    <p style="margin:0;">
      raylib-q bridges q's table-centric data model with real-time graphics. Everything is data:
      shapes are table rows, animations are frame tables, scenes are registries, UIs are immediate-mode
      draw calls. This lets you leverage q's strengths - vector operations, ad-hoc queries, 
      and rapid iteration - for graphics programming.
    </p>
  </div>
</section>

</div>

<footer>
  <p>
    raylib-q: Graphics programming with q/kdb+ tables
  </p>
  <p style="margin-top: 8px; color: var(--text-muted);">
    Built on raylib | FFI bridge | Table-first API
  </p>
</footer>

</body>
</html>
